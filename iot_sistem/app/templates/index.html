<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Climate Control System</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <script>
            async function fetchData() {
                try {
                    const response = await fetch('/api/status');
                    const data = await response.json();
                    console.log(data);
                    document.getElementById("temp").innerHTML = data.temperature !== null ? data.temperature + " Â°C" : "No data";
                    document.getElementById("hum").innerHTML = data.humidity !== null ? data.humidity + " %" : "No data";
                    document.getElementById("fan").innerHTML = data.fan ? "ON" : "OFF";
                    document.getElementById("heater").innerHTML = data.heater ? "ON" : "OFF";
                    document.getElementById("timestamp").innerHTML = data.timestamp ? (() => {
                        const date = new Date(data.timestamp);
                        const day = date.getDate();
                        const monthNames = ["januari", "februari", "maret", "april", "mei", "juni", "juli", "agustus", "september", "oktober", "november", "desember"];
                        const month = monthNames[date.getMonth()];
                        const year = date.getFullYear();
                        const hours = date.getHours().toString().padStart(2, '0');
                        const minutes = date.getMinutes().toString().padStart(2, '0');
                        return `${day}-${month}-${year} ${hours}:${minutes}`;
                    })() : "No data";
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            }
            setInterval(fetchData, 5000); // Fetch data every 5 seconds
            fetchData();
        </script>

        <h1>IoT Climate Control System</h1>
        <div class="status-grid">
            <div class="status-item temperature">
                <h3>Temperature</h3>
                <p id="temp">Loading...</p>
            </div>
            <div class="status-item humidity">
                <h3>Humidity</h3>
                <p id="hum">Loading...</p>
            </div>
            <div class="status-item fan">
                <h3>Fan</h3>
                <p id="fan">Loading...</p>
            </div>
            <div class="status-item heater">
                <h3>Heater</h3>
                <p id="heater">Loading...</p>
            </div>
            <div class="status-item timestamp">
                <h3>Last Update</h3>
                <p id="timestamp">Loading...</p>
            </div>
        </div>
        <button class="refresh-btn" onclick="location.reload()">Refresh</button>
    </div>
</body>
</html>